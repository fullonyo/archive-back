# Configuração de cache proxy
proxy_cache_path /var/cache/nginx/vrchieve levels=1:2 keys_zone=vrchieve_cache:10m max_size=1g inactive=60m use_temp_path=off;
proxy_temp_path /var/cache/nginx/temp;

# Configurações de segurança adicionais
map $http_upgrade $connection_upgrade {
    default upgrade;
    '' close;
}

# Rate limiting zones mais específicas
limit_req_zone $binary_remote_addr zone=login:10m rate=3r/m;
limit_req_zone $binary_remote_addr zone=register:10m rate=2r/m;
limit_req_zone $binary_remote_addr zone=upload:10m rate=5r/m;

# Blacklist de User-Agents maliciosos
map $http_user_agent $blocked_agent {
    default 0;
    ~*bot 1;
    ~*crawler 1;
    ~*spider 1;
    ~*scanner 1;
}

# Whitelist de User-Agents conhecidos (browsers legítimos)
map $http_user_agent $allowed_agent {
    default 0;
    ~*Mozilla 1;
    ~*Chrome 1;
    ~*Safari 1;
    ~*Firefox 1;
    ~*Edge 1;
    ~*Opera 1;
}

# Geo blocking (exemplo - configurar conforme necessário)
geo $blocked_country {
    default 0;
    # Exemplo de bloqueio por país (usar com cuidado)
    # 1.2.3.0/24 1; # Bloquear subnet específica
}